# 任务调度系统使用说明

## 快速开始

### 启动服务（推荐方式）

打开命令行，执行:
```bash
cd D:\testyd\task_generator
python scheduler_manager.py start
```

或者直接双击运行: `D:\testyd\task_generator\start_scheduler.bat`

### 查看服务状态

```bash
cd D:\testyd\task_generator
python scheduler_manager.py status
```

### 停止服务

```bash
cd D:\testyd\task_generator
python scheduler_manager.py stop
```

### 重启服务

```bash
cd D:\testyd\task_generator
python scheduler_manager.py restart
```

## 访问 Web 管理界面

服务启动后，打开浏览器访问: **http://127.0.0.1:4200**

在这里你可以:
- 查看所有定时任务
- 查看任务执行历史
- 手动触发任务执行
- 查看任务执行日志

## 查看日志

日志文件位置: `D:\testyd\task_generator\scheduler.log`

可以使用任何文本编辑器打开查看。

## 重要提示

1. **服务在后台运行**: 启动后关闭命令行窗口不会影响服务运行
2. **持续运行**: 服务会一直运行直到手动停止或重启电脑
3. **自动调度**: 所有任务会按照配置的时间自动执行
4. **不要重复启动**: 如果服务已经在运行，不要再次启动

## 已配置的定时任务

| 任务名称 | 执行时间 | 说明 |
|---------|---------|------|
| 统一任务生成-每日 | 每天 00:05 | 为所有平台生成每日待执行任务 |
| 统一任务生成-每周 | 每周六 00:10 | 为所有平台生成周度待执行任务 |
| 统一任务生成-每月 | 每月1号 00:15 | 为所有平台生成月度待执行任务 |
| 天猫Cookie获取 | 每天 07:00 | 执行天猫Cookie获取 |
| ERP门店数据 | 每天 07:00 | 执行ERP门店数据拉取 |
| 天猫差评数据 | 每天 07:20 | 执行天猫差评数据拉取 |
| 天猫聊天数据 | 每天 07:20 | 执行天猫聊天数据拉取 |
| 京东门店数据 | 每天 07:30 | 执行京东门店数据拉取 |
| PDD质量数据 | 每天 08:00 | 执行PDD质量数据拉取 |
| PDD差评数据 | 每天 08:30 | 执行PDD差评数据拉取 |
| PDDKPI数据 | 每天 11:00 | 执行PDDKPI数据拉取 |
| 天猫KPI数据 | 每天 11:30 | 执行天猫KPI数据拉取 |
| PDDKPI周报 | 每周六 12:00 | 执行PDDKPI周报数据拉取 |
| PDDKPI月报 | 每月3号 12:30 | 执行PDDKPI月报数据拉取 |

## 常见问题

### Q: 如何确认服务是否正常运行？

A: 执行 `python scheduler_manager.py status`，应该看到:
- ✅ Prefect服务器: 运行中
- ✅ 调度进程: X 个运行中

### Q: 启动后看不到任何窗口？

A: 这是正常的！服务在后台运行。使用 `status` 命令查看状态。

### Q: 如何手动执行某个任务？

A: 访问 http://127.0.0.1:4200，找到对应的任务，点击 "Run" 按钮。

### Q: 如何修改任务执行时间？

A: 编辑 `scheduler_config.py` 文件中的 `TASK_CONFIGS` 列表，修改对应任务的 `cron` 字段，然后重启服务。

### Q: 如何添加新任务？

A: 
1. 在 `scheduler_flows.py` 中定义新的 flow 函数
2. 在 `scheduler_config.py` 的 `TASK_CONFIGS` 中添加配置
3. 重启服务

### Q: 服务占用太多资源怎么办？

A: 可以在 `scheduler_config.py` 的 `serve()` 函数中调整 `limit` 参数，减少并发任务数。

## 故障排查

### 问题: 启动失败

**检查步骤**:
1. 确认 Python 环境正确: `python --version`
2. 确认 Prefect 已安装: `pip show prefect`
3. 查看日志文件: `scheduler.log`

### 问题: 端口被占用

**解决方法**:
```bash
python scheduler_manager.py stop
python scheduler_manager.py start
```

### 问题: 任务没有按时执行

**检查步骤**:
1. 确认服务正在运行: `python scheduler_manager.py status`
2. 访问 Web 界面查看任务状态
3. 查看日志文件确认是否有错误

## 技术支持

如有问题，请查看:
- 日志文件: `D:\testyd\task_generator\scheduler.log`
- 问题诊断报告: `D:\testyd\task_generator\问题诊断报告.md`

