# Python语法知识点详解

## 📋 目录

1. [基础数据类型](#基础数据类型)
2. [变量和常量](#变量和常量)
3. [运算符](#运算符)
4. [条件语句](#条件语句)
5. [循环语句](#循环语句)
6. [函数](#函数)
7. [异常处理](#异常处理)
8. [文件操作](#文件操作)
9. [模块和包](#模块和包)
10. [面向对象](#面向对象)

---

## 基础数据类型

### 1. 字符串 (str)

```python
# 字符串定义
name = "京东店铺"
path = r'D:\testyd\file.txt'  # 原始字符串，不转义
multi_line = """
这是多行
字符串
"""

# 字符串操作
print(f"店铺名称：{name}")  # f-string格式化
print("长度：", len(name))   # 获取长度
print("大写：", name.upper())  # 转大写
print("替换：", name.replace("京东", "JD"))  # 替换

# 字符串方法
text = "  hello world  "
print(text.strip())      # 去除首尾空格
print(text.split())      # 分割为列表
print("_".join(['a', 'b', 'c']))  # 连接列表为字符串
```

### 2. 数字类型

```python
# 整数
count = 10
row_idx = 0

# 浮点数
price = 99.99
rate = 0.15

# 数学运算
result = count + 5      # 加法
result = price * rate   # 乘法
result = 10 // 3        # 整除
result = 10 % 3         # 取余
result = 2 ** 3         # 幂运算

# 类型转换
num_str = "123"
num = int(num_str)      # 字符串转整数
float_num = float(num)  # 整数转浮点数
str_num = str(num)      # 数字转字符串
```

### 3. 布尔类型 (bool)

```python
# 布尔值
is_success = True
is_failed = False

# 布尔运算
result = True and False  # 与运算
result = True or False   # 或运算
result = not True        # 非运算

# 比较运算返回布尔值
result = 5 > 3          # True
result = "abc" == "def"  # False
result = 10 in [1, 2, 10]  # True
```

### 4. 列表 (list)

```python
# 列表定义
shops = ["店铺1", "店铺2", "店铺3"]
numbers = [1, 2, 3, 4, 5]
mixed = ["文本", 123, True]  # 可以混合类型

# 列表操作
shops.append("店铺4")        # 添加元素
shops.insert(0, "新店铺")    # 插入元素
removed = shops.pop()        # 删除并返回最后一个元素
shops.remove("店铺1")        # 删除指定元素

# 列表访问
first_shop = shops[0]        # 获取第一个元素
last_shop = shops[-1]        # 获取最后一个元素
sub_list = shops[1:3]        # 切片操作

# 列表遍历
for shop in shops:
    print(shop)

for i, shop in enumerate(shops):
    print(f"{i}: {shop}")
```

### 5. 字典 (dict)

```python
# 字典定义
shop_info = {
    "name": "测试店铺",
    "profile": "Profile 1",
    "status": "待下载"
}

# 字典操作
shop_info["status"] = "已完成"     # 修改值
shop_info["date"] = "2025-09-26"  # 添加新键值对
status = shop_info.get("status", "未知")  # 安全获取值

# 字典遍历
for key, value in shop_info.items():
    print(f"{key}: {value}")

for key in shop_info.keys():
    print(key)

for value in shop_info.values():
    print(value)
```

---

## 变量和常量

### 变量命名规则

```python
# 正确的变量名
shop_name = "店铺名称"      # 使用下划线
maxAttempts = 60          # 驼峰命名
file_path_2 = "路径"      # 可以包含数字

# 错误的变量名（不要这样写）
# 2file_path = "错误"     # 不能以数字开头
# shop-name = "错误"      # 不能包含连字符
# class = "错误"          # 不能使用关键字
```

### 常量定义

```python
# Python中没有真正的常量，但约定用大写表示
BASE_URL = "https://api.example.com"
MAX_RETRY_COUNT = 3
DEFAULT_TIMEOUT = 30

# 配置常量
EXCEL_PATH = r'D:\testyd\店铺信息表.xlsx'
MINIO_BUCKET = "warehouse"
```

---

## 运算符

### 算术运算符

```python
a, b = 10, 3

print(a + b)    # 13 - 加法
print(a - b)    # 7  - 减法
print(a * b)    # 30 - 乘法
print(a / b)    # 3.333... - 除法
print(a // b)   # 3  - 整除
print(a % b)    # 1  - 取余
print(a ** b)   # 1000 - 幂运算
```

### 比较运算符

```python
x, y = 5, 10

print(x == y)   # False - 等于
print(x != y)   # True  - 不等于
print(x < y)    # True  - 小于
print(x > y)    # False - 大于
print(x <= y)   # True  - 小于等于
print(x >= y)   # False - 大于等于
```

### 逻辑运算符

```python
a, b = True, False

print(a and b)  # False - 与运算
print(a or b)   # True  - 或运算
print(not a)    # False - 非运算

# 实际应用
if status == "已完成" and file_exists:
    print("文件已存在且状态完成")
```

---

## 条件语句

### if语句基础

```python
# 基本if语句
status = "已完成"

if status == "已完成":
    print("跳过下载")
elif status == "下载中":
    print("等待完成")
else:
    print("开始下载")
```

### 复杂条件判断

```python
# 多条件判断
def should_download(shop, profile, status):
    # 检查店铺名称
    if not shop or shop.strip() == "":
        return False, "店铺名称为空"
    
    # 检查配置文件
    if not profile or profile.strip() == "":
        return False, "配置文件为空"
    
    # 检查状态
    if status == "已完成":
        return False, "已完成，跳过"
    
    return True, "可以下载"

# 使用函数
can_download, reason = should_download("店铺1", "Profile 1", "")
if can_download:
    print("开始下载")
else:
    print(f"跳过：{reason}")
```

### 三元运算符

```python
# 简化的条件表达式
status = "已完成" if download_success else "失败"

# 等价于：
if download_success:
    status = "已完成"
else:
    status = "失败"
```

---

## 循环语句

### for循环

```python
# 遍历列表
shops = ["店铺1", "店铺2", "店铺3"]
for shop in shops:
    print(f"处理：{shop}")

# 遍历索引和值
for i, shop in enumerate(shops):
    print(f"{i+1}. {shop}")

# 遍历范围
for i in range(5):          # 0到4
    print(f"第{i+1}次")

for i in range(1, 6):       # 1到5
    print(f"第{i}次")

for i in range(0, 10, 2):   # 0到9，步长为2
    print(i)  # 输出：0, 2, 4, 6, 8
```

### while循环

```python
# 基本while循环
attempt = 0
max_attempts = 5

while attempt < max_attempts:
    print(f"尝试第{attempt + 1}次")
    
    # 模拟操作
    success = try_download()
    
    if success:
        print("成功！")
        break  # 跳出循环
    
    attempt += 1
    time.sleep(1)  # 等待1秒

else:
    # while循环正常结束时执行
    print("达到最大尝试次数")
```

### 循环控制

```python
# break和continue
for i in range(10):
    if i == 3:
        continue  # 跳过当前循环
    if i == 7:
        break     # 跳出循环
    print(i)

# 嵌套循环
for shop in shops:
    for attempt in range(3):
        if try_download(shop):
            break  # 只跳出内层循环
        print(f"{shop} 第{attempt+1}次尝试失败")
```

---

## 函数

### 函数定义和调用

```python
# 基本函数
def greet():
    print("Hello, World!")

# 调用函数
greet()

# 带参数的函数
def greet_user(name):
    print(f"Hello, {name}!")

greet_user("张三")

# 带返回值的函数
def add_numbers(a, b):
    result = a + b
    return result

sum_result = add_numbers(5, 3)
print(sum_result)  # 8
```

### 参数类型

```python
# 位置参数
def download_file(url, filename):
    print(f"下载 {url} 到 {filename}")

download_file("http://example.com/file.xlsx", "data.xlsx")

# 关键字参数
def download_file(url, filename, timeout=30):
    print(f"下载 {url} 到 {filename}，超时：{timeout}秒")

download_file("http://example.com/file.xlsx", filename="data.xlsx")
download_file(filename="data.xlsx", url="http://example.com/file.xlsx")

# 默认参数
def create_directory(path, exist_ok=True):
    if exist_ok or not os.path.exists(path):
        os.makedirs(path, exist_ok=exist_ok)

# 可变参数
def process_shops(*shops):
    for shop in shops:
        print(f"处理店铺：{shop}")

process_shops("店铺1", "店铺2", "店铺3")

# 关键字可变参数
def configure_browser(**kwargs):
    for key, value in kwargs.items():
        print(f"{key}: {value}")

configure_browser(headless=False, timeout=30, profile="Profile 1")
```

### 函数文档和注释

```python
def fetch_download_link(shop_name: str, profile: str) -> bool:
    """
    获取下载链接并下载文件
    
    参数:
        shop_name (str): 店铺名称
        profile (str): 浏览器配置文件
    
    返回:
        bool: 下载是否成功
    
    示例:
        >>> success = fetch_download_link("测试店铺", "Profile 1")
        >>> print(success)
        True
    """
    # 函数实现
    return True

# 查看函数帮助
help(fetch_download_link)
```

---

## 异常处理

### 基本异常处理

```python
# try-except基础
try:
    # 可能出错的代码
    result = 10 / 0
except ZeroDivisionError:
    print("不能除以零")
except Exception as e:
    print(f"发生错误：{e}")
```

### 完整异常处理

```python
def safe_download(url, filename):
    try:
        # 尝试下载
        response = requests.get(url, timeout=30)
        response.raise_for_status()  # 检查HTTP状态
        
        with open(filename, 'wb') as f:
            f.write(response.content)
        
        return True
        
    except requests.exceptions.Timeout:
        print("下载超时")
        return False
        
    except requests.exceptions.RequestException as e:
        print(f"网络请求错误：{e}")
        return False
        
    except IOError as e:
        print(f"文件操作错误：{e}")
        return False
        
    except Exception as e:
        print(f"未知错误：{e}")
        return False
        
    finally:
        # 无论是否出错都会执行
        print("清理工作完成")
```

### 自定义异常

```python
class DownloadError(Exception):
    """自定义下载异常"""
    def __init__(self, message, error_code=None):
        super().__init__(message)
        self.error_code = error_code

def download_with_retry(url, max_retries=3):
    for attempt in range(max_retries):
        try:
            # 尝试下载
            if not download_file(url):
                raise DownloadError(f"下载失败，尝试 {attempt + 1}/{max_retries}")
            return True
        except DownloadError as e:
            if attempt == max_retries - 1:
                raise  # 重新抛出异常
            print(f"重试中：{e}")
            time.sleep(1)
```

---

## 文件操作

### 基本文件读写

```python
# 读取文件
try:
    with open('data.txt', 'r', encoding='utf-8') as f:
        content = f.read()          # 读取全部内容
        # 或者
        lines = f.readlines()       # 读取所有行
        # 或者
        for line in f:              # 逐行读取
            print(line.strip())
except FileNotFoundError:
    print("文件不存在")

# 写入文件
with open('output.txt', 'w', encoding='utf-8') as f:
    f.write("Hello, World!\n")
    f.writelines(["行1\n", "行2\n", "行3\n"])

# 追加文件
with open('log.txt', 'a', encoding='utf-8') as f:
    f.write(f"日志：{datetime.now()}\n")
```

### 路径操作

```python
from pathlib import Path
import os

# 使用pathlib（推荐）
file_path = Path('D:/testyd/data.xlsx')
print(file_path.name)        # data.xlsx
print(file_path.stem)        # data
print(file_path.suffix)      # .xlsx
print(file_path.parent)      # D:/testyd
print(file_path.exists())    # True/False

# 创建目录
file_path.parent.mkdir(parents=True, exist_ok=True)

# 使用os模块
old_path = r'D:\testyd\data.xlsx'
print(os.path.basename(old_path))   # data.xlsx
print(os.path.dirname(old_path))    # D:\testyd
print(os.path.exists(old_path))     # True/False

# 创建目录
os.makedirs(r'D:\testyd\new_folder', exist_ok=True)
```

### Excel文件操作

```python
import pandas as pd

# 读取Excel
df = pd.read_excel('data.xlsx', sheet_name=0)  # 读取第一个工作表
df = pd.read_excel('data.xlsx', sheet_name='Sheet1')  # 按名称读取

# 查看数据
print(df.head())        # 前5行
print(df.tail())        # 后5行
print(df.shape)         # 形状 (行数, 列数)
print(df.columns)       # 列名
print(df.info())        # 数据信息

# 数据操作
df['新列'] = df['旧列'] * 2                    # 创建新列
filtered_df = df[df['状态'] == '已完成']        # 筛选数据
df.loc[0, '状态'] = '已完成'                   # 修改特定位置的值
df.iloc[0, 5] = '已完成'                      # 按位置修改

# 保存Excel
df.to_excel('output.xlsx', index=False, engine='openpyxl')
```

---

## 模块和包

### 导入模块

```python
# 导入整个模块
import os
import time
import json

# 使用模块
os.makedirs('folder', exist_ok=True)
time.sleep(1)
data = json.loads('{"key": "value"}')

# 导入特定函数
from datetime import datetime, timedelta
from pathlib import Path

# 直接使用函数
now = datetime.now()
yesterday = now - timedelta(days=1)

# 导入并重命名
import pandas as pd
import requests as req

# 使用重命名的模块
df = pd.read_excel('data.xlsx')
response = req.get('http://example.com')
```

### 自定义模块

```python
# 文件：my_utils.py
def format_date(date_obj):
    """格式化日期"""
    return date_obj.strftime('%Y-%m-%d')

def create_filename(shop_name, date_str):
    """创建文件名"""
    return f"{shop_name}_{date_str}.xlsx"

class FileManager:
    """文件管理器"""
    def __init__(self, base_path):
        self.base_path = Path(base_path)
    
    def create_directory(self, name):
        dir_path = self.base_path / name
        dir_path.mkdir(parents=True, exist_ok=True)
        return dir_path

# 在其他文件中使用
from my_utils import format_date, create_filename, FileManager

# 使用函数
filename = create_filename("店铺1", "2025-09-26")

# 使用类
manager = FileManager('D:/testyd')
new_dir = manager.create_directory('downloads')
```

---

## 面向对象

### 类的定义和使用

```python
class ShopDownloader:
    """店铺下载器类"""
    
    def __init__(self, base_path, timeout=30):
        """初始化方法"""
        self.base_path = Path(base_path)
        self.timeout = timeout
        self.downloaded_files = []
    
    def download_shop_data(self, shop_name, profile):
        """下载店铺数据"""
        print(f"开始下载 {shop_name} 的数据")
        
        # 创建目录
        shop_dir = self.base_path / shop_name
        shop_dir.mkdir(parents=True, exist_ok=True)
        
        # 模拟下载
        filename = f"{shop_name}.xlsx"
        file_path = shop_dir / filename
        
        # 记录下载的文件
        self.downloaded_files.append(file_path)
        
        return True
    
    def get_download_count(self):
        """获取下载文件数量"""
        return len(self.downloaded_files)
    
    def __str__(self):
        """字符串表示"""
        return f"ShopDownloader(base_path={self.base_path}, files={len(self.downloaded_files)})"

# 使用类
downloader = ShopDownloader('D:/downloads')
downloader.download_shop_data("店铺1", "Profile 1")
downloader.download_shop_data("店铺2", "Profile 2")

print(f"已下载 {downloader.get_download_count()} 个文件")
print(downloader)
```

### 继承

```python
class AdvancedDownloader(ShopDownloader):
    """高级下载器，继承自ShopDownloader"""
    
    def __init__(self, base_path, timeout=30, max_retries=3):
        super().__init__(base_path, timeout)  # 调用父类初始化
        self.max_retries = max_retries
    
    def download_with_retry(self, shop_name, profile):
        """带重试的下载"""
        for attempt in range(self.max_retries):
            try:
                success = self.download_shop_data(shop_name, profile)
                if success:
                    return True
            except Exception as e:
                print(f"第{attempt + 1}次尝试失败：{e}")
                if attempt < self.max_retries - 1:
                    time.sleep(1)
        
        return False

# 使用继承的类
advanced_downloader = AdvancedDownloader('D:/downloads', max_retries=5)
success = advanced_downloader.download_with_retry("店铺1", "Profile 1")
```

---

## 实用技巧

### 列表推导式

```python
# 传统方式
squares = []
for i in range(10):
    squares.append(i ** 2)

# 列表推导式
squares = [i ** 2 for i in range(10)]

# 带条件的列表推导式
even_squares = [i ** 2 for i in range(10) if i % 2 == 0]

# 处理字符串列表
shops = ["  店铺1  ", "  店铺2  ", "  店铺3  "]
clean_shops = [shop.strip() for shop in shops if shop.strip()]
```

### 字典推导式

```python
# 创建字典
shop_status = {f"店铺{i}": "待下载" for i in range(1, 6)}

# 从列表创建字典
shops = ["店铺1", "店铺2", "店铺3"]
shop_dict = {shop: i for i, shop in enumerate(shops)}
```

### 生成器

```python
def read_large_file(filename):
    """生成器函数，逐行读取大文件"""
    with open(filename, 'r', encoding='utf-8') as f:
        for line in f:
            yield line.strip()

# 使用生成器
for line in read_large_file('large_file.txt'):
    process_line(line)
```

### 装饰器

```python
import functools
import time

def timer(func):
    """计时装饰器"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"{func.__name__} 执行时间：{end_time - start_time:.2f}秒")
        return result
    return wrapper

@timer
def download_file(url):
    """下载文件"""
    time.sleep(2)  # 模拟下载
    return "下载完成"

# 使用装饰器
result = download_file("http://example.com/file.xlsx")
```

---

## 调试技巧

### 使用print调试

```python
def complex_function(data):
    print(f"输入数据：{data}")  # 调试输出
    
    processed_data = process_data(data)
    print(f"处理后数据：{processed_data}")  # 调试输出
    
    result = calculate_result(processed_data)
    print(f"计算结果：{result}")  # 调试输出
    
    return result
```

### 使用logging模块

```python
import logging

# 配置日志
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

def download_file(url):
    logger.info(f"开始下载：{url}")
    try:
        # 下载逻辑
        logger.info("下载成功")
        return True
    except Exception as e:
        logger.error(f"下载失败：{e}")
        return False
```

### 断言调试

```python
def divide(a, b):
    assert b != 0, "除数不能为零"  # 断言检查
    return a / b

# 使用断言检查数据
def process_shop_data(shop_name, data):
    assert isinstance(shop_name, str), "店铺名称必须是字符串"
    assert len(data) > 0, "数据不能为空"
    
    # 处理逻辑
    return processed_data
```

---

这个语法知识点文档涵盖了Python的核心概念，结合京东数据拉取脚本的实际应用场景。建议按顺序学习，每个知识点都要动手实践！