# å¤©çŒ«çˆ¬è™«ç³»ç»Ÿ - æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**æœ¬æ–‡æ¡£ç›®çš„ï¼š**
- å¿«é€Ÿäº†è§£å¤©çŒ«çˆ¬è™«ç³»ç»Ÿçš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹å¼
- æ–°å¢çˆ¬è™«æ—¶çš„æ“ä½œæŒ‡å—
- ç»´æŠ¤å’Œæ•…éšœæ’æŸ¥

**æœ€åæ›´æ–°ï¼š** 2025-10-04

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

**ä»»åŠ¡ç”Ÿæˆä¸æ‰§è¡Œåˆ†ç¦»**
- âœ… ä»»åŠ¡ç”Ÿæˆï¼šç”± `D:\testyd\task_generator` ç»Ÿä¸€ç”Ÿæˆæ‰€æœ‰å¹³å°ä»»åŠ¡
- âœ… ä»»åŠ¡æ‰§è¡Œï¼šå„çˆ¬è™«è„šæœ¬åªè´Ÿè´£æ‰§è¡Œä»»åŠ¡å¹¶æ›´æ–°çŠ¶æ€
- âœ… ç»Ÿä¸€è°ƒåº¦ï¼šç”± `task_generator` ç»Ÿä¸€è°ƒåº¦æ‰€æœ‰ä»»åŠ¡

### æ¶æ„æµç¨‹

```
1. ä»»åŠ¡ç”Ÿæˆï¼ˆç»Ÿä¸€ï¼‰
   â†“
   D:\testyd\task_generator\generate_all_tasks.py
   - æ¯å¤©00:05è‡ªåŠ¨ä¸ºæ‰€æœ‰å¹³å°ç”Ÿæˆä»»åŠ¡
   - åœ¨tm_tasksè¡¨ä¸­åˆ›å»ºè®°å½•ï¼ŒçŠ¶æ€ä¸º"å¾…æ‰§è¡Œ"
   â†“
2. ä»»åŠ¡æ‰§è¡Œï¼ˆå„çˆ¬è™«ï¼‰
   â†“
   tm_badscore.py / tm_chat.py / tm_kpi.py
   - ä»tm_tasksè¡¨è¯»å–"å¾…æ‰§è¡Œ"ä»»åŠ¡
   - æ‰§è¡Œæ•°æ®é‡‡é›†
   - æ›´æ–°çŠ¶æ€ä¸º"å·²å®Œæˆ"
   â†“
3. æ•°æ®ä¸Šä¼ 
   â†“
   - åˆå¹¶Excelæ–‡ä»¶
   - è½¬æ¢ä¸ºParquetæ ¼å¼
   - ä¸Šä¼ åˆ°MinIO
   - åˆ·æ–°Dremioè¡¨
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tm_new/
â”œâ”€â”€ æ¶æ„æ–‡æ¡£.md                # æœ¬æ–‡æ¡£
â”œâ”€â”€ crawler_config.py          # çˆ¬è™«é…ç½®æ–‡ä»¶ï¼ˆå¾…åˆ›å»ºï¼‰
â”œâ”€â”€ get_tm_cookies.py          # Cookieè·å–å·¥å…·
â”œâ”€â”€ cookie_optimizer.py        # Cookieä¼˜åŒ–å™¨
â”œâ”€â”€ tm_badscore.py            # å·®è¯„æ•°æ®é‡‡é›†
â”œâ”€â”€ tm_chat.py                # èŠå¤©æ•°æ®é‡‡é›†
â”œâ”€â”€ tm_kpi.py                 # KPIæ•°æ®é‡‡é›†
â”œâ”€â”€ tm_kpi_weekly.py          # KPIå‘¨æŠ¥é‡‡é›†ï¼ˆå¾…å®ç°ï¼‰
â”œâ”€â”€ tm_kpi_monthly.py         # KPIæœˆæŠ¥é‡‡é›†ï¼ˆå¾…å®ç°ï¼‰
â””â”€â”€ README.md                 # ä½¿ç”¨è¯´æ˜
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### tm_shops è¡¨ï¼ˆåº—é“ºä¿¡æ¯ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| shop_name | VARCHAR | åº—é“ºåç§°ï¼ˆä¸»é”®ï¼‰ |
| qncookie | TEXT | åƒç‰›Cookie |
| sycmcookie | TEXT | ç”Ÿæ„å‚è°‹Cookie |
| userNick | VARCHAR | ç”¨æˆ·æ˜µç§° |
| reportTemplateId | VARCHAR | æŠ¥è¡¨æ¨¡æ¿ID |
| profile | VARCHAR | æµè§ˆå™¨é…ç½®æ–‡ä»¶ |

### tm_tasks è¡¨ï¼ˆä»»åŠ¡è®°å½•ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| time_period | DATE | æ—¶é—´å‘¨æœŸï¼ˆä¸»é”®ï¼‰ |
| shop_name | VARCHAR | åº—é“ºåç§°ï¼ˆä¸»é”®ï¼‰ |
| badscore_status | VARCHAR | å·®è¯„ä»»åŠ¡çŠ¶æ€ |
| chat_status | VARCHAR | èŠå¤©ä»»åŠ¡çŠ¶æ€ |
| kpi_self_status | VARCHAR | KPIè‡ªåˆ¶æŠ¥è¡¨ä»»åŠ¡çŠ¶æ€ |
| kpi_official_status | VARCHAR | KPIå®˜æ–¹æŠ¥è¡¨ä»»åŠ¡çŠ¶æ€ |
| kpi_weekly_status | VARCHAR | KPIå‘¨æŠ¥ä»»åŠ¡çŠ¶æ€ |
| kpi_monthly_status | VARCHAR | KPIæœˆæŠ¥ä»»åŠ¡çŠ¶æ€ |

**ä»»åŠ¡çŠ¶æ€å€¼ï¼š**
- `NULL` - æ— ä»»åŠ¡
- `å¾…æ‰§è¡Œ` - ä»»åŠ¡å·²ç”Ÿæˆï¼Œç­‰å¾…æ‰§è¡Œ
- `å·²å®Œæˆ` - ä»»åŠ¡å·²å®Œæˆ

---

## ğŸš€ æ ¸å¿ƒçˆ¬è™«è¯´æ˜

### 1. tm_badscore.py - å·®è¯„æ•°æ®é‡‡é›†

**åŠŸèƒ½ï¼š** é‡‡é›†å¤©çŒ«åº—é“ºçš„å·®è¯„æ•°æ®

**æ—¥æœŸåç§»ï¼š** T-1ï¼ˆæ˜¨å¤©ï¼‰

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
cd D:\testyd\tm_new
python tm_badscore.py
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ä»tm_tasksè¡¨è¯»å–badscore_status="å¾…æ‰§è¡Œ"çš„ä»»åŠ¡
2. éå†æ¯ä¸ªåº—é“ºï¼Œè°ƒç”¨APIè·å–å·®è¯„æ•°æ®
3. ä¿å­˜ä¸ºExcelæ–‡ä»¶
4. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"å·²å®Œæˆ"
5. åˆå¹¶æ‰€æœ‰æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°MinIO

**APIæ¥å£ï¼š** `https://h5api.m.taobao.com/h5/mtop.rm.sellercenter.list.data.pc/1.0/`

---

### 2. tm_chat.py - èŠå¤©æ•°æ®é‡‡é›†

**åŠŸèƒ½ï¼š** é‡‡é›†å¤©çŒ«åº—é“ºçš„å®¢æœèŠå¤©è®°å½•

**æ—¥æœŸåç§»ï¼š** T-1ï¼ˆæ˜¨å¤©ï¼‰

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
cd D:\testyd\tm_new
python tm_chat.py
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ä»tm_tasksè¡¨è¯»å–chat_status="å¾…æ‰§è¡Œ"çš„ä»»åŠ¡
2. éå†æ¯ä¸ªåº—é“ºï¼Œè·å–å®¢æˆ·åˆ—è¡¨
3. è·å–æ¯ä¸ªå®¢æˆ·çš„èŠå¤©è®°å½•
4. ä¿å­˜ä¸ºExcelæ–‡ä»¶
5. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"å·²å®Œæˆ"
6. åˆå¹¶æ‰€æœ‰æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°MinIO

**APIæ¥å£ï¼š**
- å®¢æˆ·åˆ—è¡¨ï¼š`https://h5api.m.taobao.com/h5/mtop.taobao.wireless.amp2.paas.conversation.list/1.0/`
- èŠå¤©è®°å½•ï¼š`https://h5api.m.taobao.com/h5/mtop.taobao.wireless.amp2.im.paas.message.list/1.0/`

**ç‰¹ç‚¹ï¼š** æ”¯æŒå¹¶å‘å¤„ç†ï¼Œæœ€å¤§6ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†åº—é“º

---

### 3. tm_kpi.py - KPIæ•°æ®é‡‡é›†

**åŠŸèƒ½ï¼š** é‡‡é›†å¤©çŒ«åº—é“ºçš„å®¢æœç»©æ•ˆæ•°æ®

**æ—¥æœŸåç§»ï¼š** T-4ï¼ˆ4å¤©å‰ï¼‰

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
cd D:\testyd\tm_new
python tm_kpi.py
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ä»tm_tasksè¡¨è¯»å–kpi_self_status="å¾…æ‰§è¡Œ"çš„ä»»åŠ¡
2. è·å–è‡ªåˆ¶æŠ¥è¡¨æ•°æ®
3. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"å·²å®Œæˆ"
4. ä»tm_tasksè¡¨è¯»å–kpi_official_status="å¾…æ‰§è¡Œ"çš„ä»»åŠ¡
5. è·å–å®˜æ–¹æŠ¥è¡¨æ•°æ®
6. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º"å·²å®Œæˆ"
7. åˆ†åˆ«åˆå¹¶å¹¶ä¸Šä¼ åˆ°MinIO

**APIæ¥å£ï¼š**
- è‡ªåˆ¶æŠ¥è¡¨ï¼š`https://sycm.taobao.com/custom/report/download`
- å®˜æ–¹æŠ¥è¡¨ï¼š`https://sycm.taobao.com/custom/report/download`

---

## ğŸ”§ Cookieè·å–å·¥å…·

### get_tm_cookies.py

**åŠŸèƒ½ï¼š** è‡ªåŠ¨è·å–å¤©çŒ«åº—é“ºçš„Cookie

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
cd D:\testyd\tm_new
python get_tm_cookies.py
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ä»tm_shopsè¡¨è¯»å–æ‰€æœ‰åº—é“º
2. ä½¿ç”¨Playwrightå¯åŠ¨æµè§ˆå™¨
3. åŠ è½½åº—é“ºçš„æµè§ˆå™¨é…ç½®æ–‡ä»¶
4. è®¿é—®åƒç‰›å’Œç”Ÿæ„å‚è°‹é¡µé¢
5. æå–Cookie
6. æ›´æ–°åˆ°tm_shopsè¡¨

**ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šåº—é“ºæ‰¹é‡è·å–
- è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- Cookieä¼˜åŒ–ï¼ˆç§»é™¤æ— ç”¨å­—æ®µï¼‰
- ä½¿ç”¨æŒä¹…åŒ–æµè§ˆå™¨ä¸Šä¸‹æ–‡

---

## ğŸ“ ä»»åŠ¡ç”Ÿæˆä¸æ‰§è¡Œæµç¨‹

### ä»»åŠ¡ç”Ÿæˆï¼ˆç»Ÿä¸€ï¼‰

**ä½ç½®ï¼š** `D:\testyd\task_generator\generate_all_tasks.py`

**æ‰§è¡Œæ—¶é—´ï¼š** æ¯å¤©00:05è‡ªåŠ¨æ‰§è¡Œ

**æ‰‹åŠ¨æ‰§è¡Œï¼š**
```bash
cd D:\testyd\task_generator
python generate_all_tasks.py --schedule daily --platforms tm
```

**ç”Ÿæˆé€»è¾‘ï¼š**
1. è¯»å–tm_shopsè¡¨è·å–æ‰€æœ‰åº—é“º
2. æ ¹æ®é…ç½®è®¡ç®—ç›®æ ‡æ—¥æœŸï¼ˆå¦‚T-1ã€T-4ï¼‰
3. åœ¨tm_tasksè¡¨ä¸­åˆ›å»ºè®°å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
4. è®¾ç½®å¯¹åº”ä»»åŠ¡çŠ¶æ€å­—æ®µä¸º"å¾…æ‰§è¡Œ"

### ä»»åŠ¡æ‰§è¡Œï¼ˆå„çˆ¬è™«ï¼‰

**æ‰§è¡Œæ—¶é—´ï¼š** ç”±è°ƒåº¦ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œ

**æ‰‹åŠ¨æ‰§è¡Œï¼š**
```bash
cd D:\testyd\tm_new
python tm_badscore.py  # å·®è¯„æ•°æ®
python tm_chat.py      # èŠå¤©æ•°æ®
python tm_kpi.py       # KPIæ•°æ®
```

**æ‰§è¡Œé€»è¾‘ï¼š**
1. ä»tm_tasksè¡¨è¯»å–"å¾…æ‰§è¡Œ"ä»»åŠ¡
2. éå†æ¯ä¸ªåº—é“ºæ‰§è¡Œæ•°æ®é‡‡é›†
3. é‡‡é›†æˆåŠŸåæ›´æ–°çŠ¶æ€ä¸º"å·²å®Œæˆ"
4. åˆå¹¶æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°MinIO

---

## ğŸ”„ è°ƒåº¦é…ç½®

**ä½ç½®ï¼š** `D:\testyd\task_generator\platform_config.py`

**å¤©çŒ«ä»»åŠ¡é…ç½®ï¼š**

| ä»»åŠ¡ | è°ƒåº¦ç±»å‹ | æ—¥æœŸåç§» | æ‰§è¡Œæ—¶é—´ | çŠ¶æ€å­—æ®µ |
|------|---------|---------|---------|---------|
| å·®è¯„æ•°æ® | daily | T-1 | 08:30 | badscore_status |
| èŠå¤©æ•°æ® | daily | T-1 | 09:00 | chat_status |
| KPIè‡ªåˆ¶æŠ¥è¡¨ | daily | T-4 | 10:00 | kpi_self_status |
| KPIå®˜æ–¹æŠ¥è¡¨ | daily | T-4 | 10:00 | kpi_official_status |
| KPIå‘¨æŠ¥ | weekly | T-9~T-3 | å‘¨å…­12:00 | kpi_weekly_status |
| KPIæœˆæŠ¥ | monthly | ä¸Šæœˆ | 3å·12:30 | kpi_monthly_status |

---

## ğŸ› ï¸ å¸¸ç”¨æ“ä½œ

### 1. æŸ¥çœ‹å¾…æ‰§è¡Œä»»åŠ¡

```sql
SELECT time_period, shop_name, 
       badscore_status, chat_status, 
       kpi_self_status, kpi_official_status
FROM tm_tasks
WHERE badscore_status = 'å¾…æ‰§è¡Œ' 
   OR chat_status = 'å¾…æ‰§è¡Œ'
   OR kpi_self_status = 'å¾…æ‰§è¡Œ'
   OR kpi_official_status = 'å¾…æ‰§è¡Œ';
```

### 2. é‡ç½®ä»»åŠ¡çŠ¶æ€

```sql
-- é‡ç½®æŸä¸ªæ—¥æœŸçš„å·®è¯„ä»»åŠ¡
UPDATE tm_tasks 
SET badscore_status = 'å¾…æ‰§è¡Œ' 
WHERE time_period = '2025-10-03';

-- é‡ç½®æŸä¸ªåº—é“ºçš„æ‰€æœ‰ä»»åŠ¡
UPDATE tm_tasks 
SET badscore_status = 'å¾…æ‰§è¡Œ',
    chat_status = 'å¾…æ‰§è¡Œ',
    kpi_self_status = 'å¾…æ‰§è¡Œ'
WHERE shop_name = 'åº—é“ºåç§°';
```

### 3. æ‰‹åŠ¨ç”Ÿæˆä»»åŠ¡

```bash
cd D:\testyd\task_generator
python generate_all_tasks.py --schedule daily --platforms tm --date 2025-10-03
```

### 4. æ›´æ–°Cookie

```bash
cd D:\testyd\tm_new
python get_tm_cookies.py
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ç»Ÿä¸€ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ**: `D:\testyd\task_generator\README.md`
- **è°ƒåº¦ç³»ç»Ÿæ–‡æ¡£**: `D:\testyd\task_generator\è°ƒåº¦ç³»ç»Ÿæ–‡æ¡£.md`
- **PDDæ¶æ„æ–‡æ¡£**: `D:\testyd\pdd\æ¶æ„æ–‡æ¡£.md`

---

## âš ï¸ é‡è¦è¯´æ˜

1. **ä»»åŠ¡ç”Ÿæˆç»Ÿä¸€ç®¡ç†** - ä¸è¦åœ¨å„çˆ¬è™«è„šæœ¬ä¸­å•ç‹¬ç”Ÿæˆä»»åŠ¡
2. **çŠ¶æ€æ›´æ–°åŠæ—¶** - ä»»åŠ¡å®Œæˆåå¿…é¡»æ›´æ–°çŠ¶æ€ä¸º"å·²å®Œæˆ"
3. **Cookieå®šæœŸæ›´æ–°** - Cookieè¿‡æœŸä¼šå¯¼è‡´é‡‡é›†å¤±è´¥
4. **æ—¥æœŸåç§»æ³¨æ„** - ä¸åŒä»»åŠ¡çš„æ—¥æœŸåç§»ä¸åŒï¼Œæ³¨æ„é…ç½®

---

**ç»´æŠ¤è€…ï¼š** AI Assistant  
**æœ€åæ›´æ–°ï¼š** 2025-10-04  
**ç‰ˆæœ¬ï¼š** 1.0.0

